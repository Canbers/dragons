<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="D&D Style Adventure Game">
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="map-styles.css">
    <title>Adventure Game</title>
</head>
<body>
<!-- Auth container -->
<div id="auth-container" class="auth-container">
    <button id="login-btn" class="auth-button" style="display: none;">Login</button>
    <div id="user-menu" class="user-menu" style="display: none;">
        <button id="user-menu-button">
            <span id="username">Username</span> <i class="arrow down"></i>
        </button>
        <div id="user-dropdown" class="dropdown-content" style="display: none;">
            <button id="profile-btn">View Profile</button>
            <button id="logout-btn">Logout</button>
        </div>
    </div>
</div>

<div id="main-container">
    <!-- LEFT COLUMN: Game Log (Primary) -->
    <div id="game-log-column">
        <!-- Header Bar -->
        <div id="game-header">
            <h1 id="world-name">ğŸ‰ Dragons</h1>
            <div id="header-status">
                <span id="time-display">â° --</span>
                <span id="health-display">â¤ï¸ --</span>
            </div>
        </div>

        <!-- Chat/Log Section -->
        <div id="chat-section">
            <div id="game-log"></div>
            
            <!-- Context Bar -->
            <div id="context-bar">
                <span id="location-context">ğŸ“ --</span>
                <span id="activity-context">âš”ï¸ --</span>
                <span id="conditions-context">ğŸŒ¤ï¸ --</span>
            </div>
            
            <!-- Action Panel (Primary interaction) -->
            <div id="quick-actions">
                <div id="dynamic-actions">
                    <button class="quick-action dynamic-action" data-action="I approach someone nearby and greet them">ğŸ’¬ Talk</button>
                    <button class="quick-action dynamic-action" data-action="I check my belongings and inventory">ğŸ’ Inventory</button>
                    <button class="quick-action dynamic-action" data-action="I explore the area further">ğŸ” Explore</button>
                </div>
                <div id="static-actions">
                    <button class="quick-action static-action" data-action="I look around carefully">ğŸ‘€ Look</button>
                    <button class="quick-action static-action" data-action="I find a safe spot to rest and catch my breath">ğŸ’¤ Rest</button>
                </div>
            </div>

            <!-- Custom Action (Secondary - for free-form input) -->
            <div id="input-area">
                <div id="input-row">
                    <input id="chat-box" type="text" placeholder="Or type your own action...">
                    <button id="submit-btn">Go</button>
                    <button id="ask-gm-btn" title="Step out of character to ask the Game Master a question about how the game works">?</button>
                </div>
            </div>
        </div>
    </div>

    <!-- RIGHT COLUMN: Sidebar (Map + Character) -->
    <div id="sidebar-column">
        <!-- Map Section (Top) -->
        <div id="map-section">
            <h3>ğŸ—ºï¸ World Map</h3>
            <div id="map-viewer-container"></div>
        </div>

        <!-- Character Panel (Bottom - Glanceable) -->
        <div id="character-panel">
            <h3>ğŸ‘¤ Character</h3>
            <div id="character-glance">
                <div id="character-name">--</div>
                <div id="character-stats">
                    <div class="stat-bar-mini">
                        <span class="stat-icon">â¤ï¸</span>
                        <div class="stat-bar-bg"><div id="health-bar" class="stat-bar-fill health"></div></div>
                        <span id="health-value">--</span>
                    </div>
                    <div class="stat-bar-mini">
                        <span class="stat-icon">ğŸ’™</span>
                        <div class="stat-bar-bg"><div id="mana-bar" class="stat-bar-fill mana"></div></div>
                        <span id="mana-value">--</span>
                    </div>
                </div>
                <div id="character-quick-info">
                    <span id="character-class">--</span> â€¢ <span id="character-level">--</span>
                </div>
                <button id="expand-character-btn">ğŸ“‹ Full Sheet</button>
            </div>
            <!-- Full character sheet (hidden by default) -->
            <div id="character-details" style="display: none;"></div>
        </div>
        
        <!-- Game Buttons -->
        <div id="game-buttons">
            <button id="start-game-btn">â–¶ï¸ Start</button>
            <button id="view-quests-btn">ğŸ“œ Journal</button>
            <button id="reputation-btn">ğŸ¤ Rep</button>
            <button id="story-summary-btn">ğŸ“– Story</button>
            <button id="settings-btn">âš™ï¸</button>
        </div>
    </div>
</div>

<!-- ========== MODALS (outside main-container) ========== -->

<!-- Settings Modal -->
<div id="settings-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="close-settings-modal">&times;</span>
        <h3>âš™ï¸ Game Settings</h3>
        <div class="settings-section">
            <label for="tone-select"><strong>World Tone:</strong></label>
            <select id="tone-select">
                <option value="classic">Classic Fantasy</option>
                <option value="dark">Dark & Gritty</option>
                <option value="whimsical">Whimsical</option>
            </select>
            <p class="setting-description" id="tone-description">A world of adventure and wonder, with danger and consequence.</p>
        </div>
        <div class="settings-section">
            <label for="difficulty-select"><strong>Difficulty:</strong></label>
            <select id="difficulty-select">
                <option value="casual">Casual</option>
                <option value="hardcore">Hardcore</option>
            </select>
            <p class="setting-description" id="difficulty-description">Failures result in setbacks, but rarely death.</p>
        </div>
        <button id="save-settings-btn">Save Settings</button>
    </div>
</div>

<!-- Quest Journal Modal -->
<div id="quests-modal" class="modal" style="display: none;">
    <div class="modal-content quest-journal">
        <span class="close" id="close-quests-modal">&times;</span>
        <h3>Quest Journal</h3>
        <div id="quest-journal-content">
            <div class="qj-section" id="qj-active">
                <h4>Active Quests</h4>
                <div class="qj-list" id="qj-active-list"></div>
            </div>
            <div class="qj-section" id="qj-leads">
                <h4>Leads</h4>
                <div class="qj-list" id="qj-leads-list"></div>
            </div>
            <div class="qj-section" id="qj-completed">
                <h4>Completed</h4>
                <div class="qj-list" id="qj-completed-list"></div>
            </div>
        </div>
    </div>
</div>

<!-- Reputation Modal -->
<div id="reputation-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="close-reputation-modal">&times;</span>
        <h3>ğŸ¤ Reputation</h3>
        <div id="reputation-content">
            <div class="reputation-section">
                <h4>Known NPCs</h4>
                <div id="reputation-npcs">Loading...</div>
            </div>
            <div class="reputation-section">
                <h4>Faction Standing</h4>
                <div id="reputation-factions">Loading...</div>
            </div>
            <div class="reputation-section">
                <h4>Local Reputation</h4>
                <div id="reputation-locations">Loading...</div>
            </div>
        </div>
    </div>
</div>

<!-- Settlement Details Modal -->
<div id="settlement-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <span class="close" id="close-settlement-modal">&times;</span>
        <div id="settlement-details"></div>
    </div>
</div>

<!-- Game Init Overlay -->
<div id="game-init-overlay" style="display: none;">
    <div class="init-overlay-content">
        <div class="init-dragon-icon">&#x1F409;</div>
        <h2 class="init-title">Preparing Your Adventure</h2>
        <div class="init-progress-container">
            <div class="init-progress-bar">
                <div id="init-progress-fill" class="init-progress-fill"></div>
            </div>
            <p id="init-progress-message" class="init-message">Connecting to the world...</p>
        </div>
        <button id="init-retry-btn" class="btn-primary" style="display: none;">Retry</button>
    </div>
</div>

<!-- Game Console (Dev/Debug) -->
<button id="console-toggle" title="Game Console">&gt;_</button>
<div id="game-console" style="display: none;">
    <div id="game-console-header">
        <span>Game Console</span>
        <button id="console-clear" title="Clear">Clear</button>
    </div>
    <div id="game-console-log"></div>
</div>

<!-- Toast Notification Container -->
<div id="toast-container"></div>

<script src="/MapViewer.js"></script>
<script src="/narrative-formatter.js"></script>
<script src="/action-panel.js"></script>
<script src="/app.js" type="module"></script>
</body>
</html>
